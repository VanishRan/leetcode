##### 1.1 索引

RelationalDB	->	Databases	->	Tables	->	Rows	->	Columns

Elasticsearch	->	Indices		->	Types	 ->	Documents	->	Fields



##### 1.2 搜索

**插入一条数据**

`PUT	/megacorp/employee/1` 

`{`

`"first_name"	:	"John",`

`"last_name"	:		"Smith",`

`"age"	:								25,`

`"about"	:						"I	love	to	go	rock	climbing",`

`"interests":	[	"sports",	"music"	]`

`}` 



**简单搜索**

搜索全部员工，返回前10个

GET	/megacorp/employee/_search  

搜索id=1的员工

GET	/megacorp/employee/1           

搜索姓氏中包含**“Smith”**的员工

GET	/megacorp/employee/_search?q=last_name:Smith



**使用DSL语句查询** 

`GET	/megacorp/employee/_search`

`{`

`"query"	:	{`

`		"match"	:	{`

`	"last_name"	:	"Smith"`

​								`}`

​				`}`

`}` 



**更复杂的搜索**

GET	/megacorp/employee/_search

{
  "query":{
    "filtered":{
      "filter":{
        "range":{
          "age":{
            "gt":30
          }
        }
      },
      "query":{
        "match":{
          "last_name":"smith"
        }
      }
    }
  }
}



**全文搜索**

搜索所有喜欢**“rock climbing”**的员工（有其中一个单词rock或climbing就会被搜索出来）：

GET	/megacorp/employee/_search

{

"query"	:	{

​		"match"	:	{

​				"about"	:	"rock	climbing"

​								}

​				}

}



**短语搜索**

我们想要查询同时包含"rock"和"climbing"（并且是相邻的）的员工记录：

GET	/megacorp/employee/_search

{

"query"	:	{

​		"match_phrase"	:	{

​				"about"	:	"rock	climbing"

​								}

​				}

}



**高亮我们的搜索**

GET	/megacorp/employee/_search

{

"query"	:	{

​		"match_phrase"	:	{

​				"about"	:	"rock	climbing"

​				}

​		},

​		"highlight":	{

​				"fields"	:	{

​						"about"	:	{}

​		     	}

​	 	}

}



**1.3 聚合**

举个例子，让我们找到所有职员中最大的共同点（兴趣爱好）是什么

GET	/megacorp/employee/_search

{

"aggs":	{

​		"all_interests":	{

​				"terms":	{	"field":	"interests"	}

​				}

​		}

}



如果我们想知道所有姓"Smith"的人最大的共同点（兴趣爱好），我们只需要增加合适的语句既可：

GET	/megacorp/employee/_search

{

"query":	{

​		"match":	{

​				"last_name":	"smith"

​				}

​		},

"aggs":	{

​		"all_interests":	{

​				"terms":	{

​						"field":	"interests"

​						}

​				}

​		}

}



聚合也允许分级汇总。例如，让我们统计每种兴趣下职员的平均年龄：

GET	/megacorp/employee/_search

{

"aggs"	:	{

​		"all_interests"	:	{

​					"terms"	:	{	"field"	:	"interests"	},

​					"aggs"	:	{

​							"avg_age"	:	{

​							 		"avg"	:	{	"field"	:	"age"	}

​																}

​												}

​								}

​				}

} 